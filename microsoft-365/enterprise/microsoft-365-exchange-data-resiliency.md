---
title: Exchange Online data återhämtning i Microsoft 365
ms.author: josephd
author: JoeDavies-MSFT
manager: laurawi
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
f1.keywords:
- NOCSH
description: I den här artikeln hittar du en förklaring av de olika aspekterna av data återhämtning i Exchange Online och Microsoft 365.
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: dfc53fd48a6de61cf47a0441cd2f8b0fa35a73f1
ms.sourcegitcommit: 79065e72c0799064e9055022393113dfcf40eb4b
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 08/14/2020
ms.locfileid: "46696684"
---
# <a name="exchange-online-data-resiliency-in-microsoft-365"></a><span data-ttu-id="91da6-103">Exchange Online data återhämtning i Microsoft 365</span><span class="sxs-lookup"><span data-stu-id="91da6-103">Exchange Online Data Resiliency in Microsoft 365</span></span>

<span data-ttu-id="91da6-104">Det finns två typer av skador som kan påverka en Exchange-databas: fysisk skada, som vanligt vis orsakas av maskin varu problem (särskilt lagrings hård vara) och logiskt fel, som beror på andra faktorer.</span><span class="sxs-lookup"><span data-stu-id="91da6-104">There are two types of corruption that can affect an Exchange database: physical corruption, which is typically caused by hardware (in particular, storage hardware) problems, and logical corruption, which occurs due to other factors.</span></span> <span data-ttu-id="91da6-105">Vanligt vis finns det två typer av logiska skador som kan uppstå i en Exchange-databas:</span><span class="sxs-lookup"><span data-stu-id="91da6-105">Generally, there are two types of logical corruption that can occur within an Exchange database:</span></span> 
- <span data-ttu-id="91da6-106">**Logisk databas skada** – sid kontroll summan för databasen matchar, men data på sidan är fel logiskt.</span><span class="sxs-lookup"><span data-stu-id="91da6-106">**Database logical corruption** - The database page checksum matches, but the data on the page is wrong logically.</span></span> <span data-ttu-id="91da6-107">Det här kan inträffa om databas motorn (Extensible Storage Engine (ESE) försöker skriva en databas sida och trots att operativ systemet returnerar ett meddelande om att det är lyckat, har data antingen aldrig skrivits till disken eller så har de skrivits till fel plats.</span><span class="sxs-lookup"><span data-stu-id="91da6-107">This can occur when the database engine (the Extensible Storage Engine (ESE)) attempts to write a database page and even though the operating system returns a success message, the data is either never written to the disk or it's written to the wrong place.</span></span> <span data-ttu-id="91da6-108">Detta kallas för *förlorad tömning*.</span><span class="sxs-lookup"><span data-stu-id="91da6-108">This is referred to as a *lost flush*.</span></span> <span data-ttu-id="91da6-109">ESE innehåller flera funktioner och säkerhets åtgärder som är avsedda att förhindra fysisk skada av en databas och andra scenarier för data förlust.</span><span class="sxs-lookup"><span data-stu-id="91da6-109">ESE includes numerous features and safeguards that are designed to prevent physical corruption of a database and other data loss scenarios.</span></span> <span data-ttu-id="91da6-110">För att förhindra förlorad rensning från att förlora data innehåller ESE en förlorad funktion för dubblettidentifiering i databasen tillsammans med en funktion (återställning med enkel sida) för att korrigera det.</span><span class="sxs-lookup"><span data-stu-id="91da6-110">To prevent lost flushes from losing data, ESE includes a lost flush detection mechanism in the database along with a feature (single page restore) to correct it.</span></span> 
- <span data-ttu-id="91da6-111">**Lagra logisk skada** – data läggs till, tas bort eller ändras på ett sätt som användaren inte förväntar dig.</span><span class="sxs-lookup"><span data-stu-id="91da6-111">**Store logical corruption** - Data is added, deleted, or manipulated in a way that the user doesn't expect.</span></span> <span data-ttu-id="91da6-112">Dessa fall orsakas normalt av tredjepartsprogram.</span><span class="sxs-lookup"><span data-stu-id="91da6-112">These cases are generally caused by third-party applications.</span></span> <span data-ttu-id="91da6-113">Det är vanligt vis bara problem med att användaren visar den som skador.</span><span class="sxs-lookup"><span data-stu-id="91da6-113">It's generally only corruption in the sense that the user views it as corruption.</span></span> <span data-ttu-id="91da6-114">I Exchange-arkivet behandlas den transaktion som gav upphov till det logiska skada som en serie giltiga MAPI-åtgärder.</span><span class="sxs-lookup"><span data-stu-id="91da6-114">The Exchange store considers the transaction that produced the logical corruption to be a series of valid MAPI operations.</span></span> <span data-ttu-id="91da6-115">[In-Place Hold](https://docs.microsoft.com/exchange/security-and-compliance/create-or-remove-in-place-holds) -funktioner i Exchange Online ger skydd mot lagring av logiska skador (eftersom innehållet inte tas bort permanent av en användare eller ett program).</span><span class="sxs-lookup"><span data-stu-id="91da6-115">The [In-Place Hold](https://docs.microsoft.com/exchange/security-and-compliance/create-or-remove-in-place-holds) features in Exchange Online provides protection from store logical corruption (because it prevents content from being permanently deleted by a user or an application).</span></span> 

<span data-ttu-id="91da6-116">Exchange Online utför flera konsekvens kontroller av replikerade loggfiler under både granskning och utloggning.</span><span class="sxs-lookup"><span data-stu-id="91da6-116">Exchange Online performs several consistency checks on replicated log files during both log inspection and log replay.</span></span> <span data-ttu-id="91da6-117">Dessa konsekvens kontroller hindrar fysiska skador från att replikeras av systemet.</span><span class="sxs-lookup"><span data-stu-id="91da6-117">These consistency checks prevent physical corruption from being replicated by the system.</span></span> <span data-ttu-id="91da6-118">Under en gransknings inspektion är exempelvis en fysisk integritets kontroll som verifierar logg filen och verifierar att den kontroll summa som är registrerad i logg filen matchar den kontroll summa som genererats i minnet.</span><span class="sxs-lookup"><span data-stu-id="91da6-118">For example, during log inspection, there is a physical integrity check which verifies the log file and validates that the checksum recorded in the log file matches the checksum generated in memory.</span></span> <span data-ttu-id="91da6-119">Dessutom kontrol leras logg filens rubrik för att se till att logg filens signatur är Sparad i logg rubriken.</span><span class="sxs-lookup"><span data-stu-id="91da6-119">In addition, the log file header is examined to make sure the log file signature recorded in the log header matches that of the log file.</span></span> <span data-ttu-id="91da6-120">Under den här återuppspelningen kan logg filen gå vidare.</span><span class="sxs-lookup"><span data-stu-id="91da6-120">During log replay, the log file undergoes further scrutiny.</span></span> <span data-ttu-id="91da6-121">Databas huvudet innehåller till exempel även loggens signatur som jämförs med logg filens signatur för att se till att den matchar.</span><span class="sxs-lookup"><span data-stu-id="91da6-121">For example, the database header also contains the log signature which is compared with the log file's signature to ensure they match.</span></span> 

<span data-ttu-id="91da6-122">Skydd mot korruption från post lådor i Exchange Online uppnås med hjälp av Exchange ursprungligt data skydd, en återhämtnings strategi som använder replikering på flera servrar och flera data Center tillsammans med andra funktioner som hjälper dig att skydda data på grund av skador eller andra orsaker.</span><span class="sxs-lookup"><span data-stu-id="91da6-122">Protection against corruption of mailbox data in Exchange Online is achieved by using Exchange Native Data Protection, a resiliency strategy that leverages application-level replication across multiple servers and multiple datacenters along with other features that help protect data from being lost due to corruption or other reasons.</span></span> <span data-ttu-id="91da6-123">De här funktionerna inkluderar inbyggda funktioner som hanteras av Microsoft eller själva Exchange Online-programmet, till exempel:</span><span class="sxs-lookup"><span data-stu-id="91da6-123">These features include native features that are managed by Microsoft or the Exchange Online application itself, such as:</span></span>

- [<span data-ttu-id="91da6-124">Data tillgänglighets grupper</span><span class="sxs-lookup"><span data-stu-id="91da6-124">Data Availability Groups</span></span>](https://docs.microsoft.com/exchange/back-up-email)
- <span data-ttu-id="91da6-125">Enkel bit korrigering</span><span class="sxs-lookup"><span data-stu-id="91da6-125">Single Bit Correction</span></span> 
- <span data-ttu-id="91da6-126">Online-databas genomsökning</span><span class="sxs-lookup"><span data-stu-id="91da6-126">Online Database Scanning</span></span> 
- <span data-ttu-id="91da6-127">Förlorad dubblettidentifiering</span><span class="sxs-lookup"><span data-stu-id="91da6-127">Lost Flush Detection</span></span> 
- <span data-ttu-id="91da6-128">Återställning med en enda sida</span><span class="sxs-lookup"><span data-stu-id="91da6-128">Single Page Restore</span></span> 
- <span data-ttu-id="91da6-129">Tjänsten Mailbox Replication</span><span class="sxs-lookup"><span data-stu-id="91da6-129">Mailbox Replication Service</span></span> 
- <span data-ttu-id="91da6-130">Logg fils kontroller</span><span class="sxs-lookup"><span data-stu-id="91da6-130">Log File Checks</span></span> 
- <span data-ttu-id="91da6-131">Distribution av elastiskt fil system</span><span class="sxs-lookup"><span data-stu-id="91da6-131">Deployment on Resilient File System</span></span> 

<span data-ttu-id="91da6-132">Om du vill ha mer information om de inbyggda funktionerna ovan klickar du på ovanstående hyperlänkar och läser nedan för ytterligare information och information om objekt utan hyperlänkar.</span><span class="sxs-lookup"><span data-stu-id="91da6-132">For more information on the native features listed above, click on the above hyperlinks, and see below for additional information and for details on items without hyperlinks.</span></span> <span data-ttu-id="91da6-133">Utöver dessa inbyggda funktioner inkluderar Exchange Online även data återhämtnings funktioner som kunder kan hantera, till exempel:</span><span class="sxs-lookup"><span data-stu-id="91da6-133">In addition to these native features, Exchange Online also includes data resiliency features that customers can manage, such as:</span></span> 
- [<span data-ttu-id="91da6-134">Återställning av enskilt objekt (aktiverat som standard)</span><span class="sxs-lookup"><span data-stu-id="91da6-134">Single Item Recovery (enabled by default)</span></span>](https://docs.microsoft.com/exchange/recipients-in-exchange-online/manage-user-mailboxes/recover-deleted-messages) 
- [<span data-ttu-id="91da6-135">Håll på plats och tvist</span><span class="sxs-lookup"><span data-stu-id="91da6-135">In-Place Hold and Litigation Hold</span></span>](https://docs.microsoft.com/exchange/security-and-compliance/in-place-and-litigation-holds) 
- [<span data-ttu-id="91da6-136">Borttagna objekt, lagrings-och borttagnings bara brev lådor (både aktiverade som standard)</span><span class="sxs-lookup"><span data-stu-id="91da6-136">Deleted Item Retention and Soft-Deleted Mailboxes (both enabled by default)</span></span>](https://docs.microsoft.com/exchange/recipients-in-exchange-online/delete-or-restore-mailboxes) 

## <a name="database-availability-groups"></a><span data-ttu-id="91da6-137">Databas tillgänglighets grupper</span><span class="sxs-lookup"><span data-stu-id="91da6-137">Database Availability Groups</span></span> 
<span data-ttu-id="91da6-138">Varje Mailbox-databas i Microsoft 365 finns i en [databas tillgänglighets grupp (dag)](https://docs.microsoft.com/exchange/back-up-email) och replikeras till geografiskt åtskilda Data Center inom samma region.</span><span class="sxs-lookup"><span data-stu-id="91da6-138">Every mailbox database in Microsoft 365 is hosted in a [database availability group (DAG)](https://docs.microsoft.com/exchange/back-up-email) and replicated to geographically-separate datacenters within the same region.</span></span> <span data-ttu-id="91da6-139">Den vanligaste konfigurationen är fyra databas kopior i fyra Data Center; i vissa regioner finns det emellertid färre data Center (databaserna replikeras till tre Data Center i Indien och två Data Center i Australien och Japan).</span><span class="sxs-lookup"><span data-stu-id="91da6-139">The most common configuration is four database copies in four datacenters; however, some regions have fewer datacenters (databases are replicated to three datacenters in India, and two datacenters in Australia and Japan).</span></span> <span data-ttu-id="91da6-140">I alla fall innehåller alla post lådor fyra kopior som fördelas på flera data källor, och säkerställer därmed att post lådorna skyddas från program vara, hård vara och till och med data Center.</span><span class="sxs-lookup"><span data-stu-id="91da6-140">But in all cases, every mailbox database has four copies that are distributed across multiple datacenters, thereby ensuring that mailbox data is protected from software, hardware, and even datacenter failures.</span></span> 

<span data-ttu-id="91da6-141">Med de här fyra kopiorna är tre av dem konfigurerade med hög tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="91da6-141">Out of these four copies, three of them are configured as highly available.</span></span> <span data-ttu-id="91da6-142">Den fjärde kopian är konfigurerad som en neddelad [databas kopia](https://docs.microsoft.com/Exchange/high-availability/manage-ha/activate-lagged-db-copies).</span><span class="sxs-lookup"><span data-stu-id="91da6-142">The fourth copy is configured as a [lagged database copy](https://docs.microsoft.com/Exchange/high-availability/manage-ha/activate-lagged-db-copies).</span></span> <span data-ttu-id="91da6-143">Den avvecklade databas kopian är inte avsedd för återställning av enskilda post lådor eller återställning av post låda.</span><span class="sxs-lookup"><span data-stu-id="91da6-143">The lagged database copy is not intended for individual mailbox recovery or mailbox item recovery.</span></span> <span data-ttu-id="91da6-144">Dess syfte är att tillhandahålla en återställnings funktion för den sällsynta händelsen i systemomfattande oåterkalleligt logiskt fel.</span><span class="sxs-lookup"><span data-stu-id="91da6-144">Its purpose is to provide a recovery mechanism for the rare event of system-wide, catastrophic logical corruption.</span></span> 

<span data-ttu-id="91da6-145">Inspelade databas kopior i Exchange Online har kon figurer ATS med en sjunde dag i en dygns lång tid.</span><span class="sxs-lookup"><span data-stu-id="91da6-145">Lagged database copies in Exchange Online are configured with a seven-day log file replay lag time.</span></span> <span data-ttu-id="91da6-146">Dessutom är Exchange Replay-fördröjningen aktive rad för att tillhandahålla dynamisk logg fil för utskrivna kopior för att tillåta att databas kopior i en utskriven fil för sig själv repare ras och hanteras.</span><span class="sxs-lookup"><span data-stu-id="91da6-146">In addition, the Exchange Replay Lag Manager is enabled to provide dynamic log file play down for lagged copies to allow lagged database copies to self-repair and manage log file growth.</span></span> <span data-ttu-id="91da6-147">Trots att databas kopior med penna används i Exchange Online är det viktigt att förstå att de inte är en garanterad säkerhets kopia.</span><span class="sxs-lookup"><span data-stu-id="91da6-147">Although lagged database copies are used in Exchange Online, it is important to understand that they are not a guaranteed point-in-time backup.</span></span> <span data-ttu-id="91da6-148">Insamlade databas kopior i Exchange Online har ett tröskelvärde för tillgänglighet, vanligt vis omkring 90%, på grund av att den disk som innehåller en avbruten kopia förloras på grund av ett diskfel, att den utskrivna kopian blir ett mycket tillgängligt exemplar (på grund av automatisk nedrullningsbarning), samt de perioder där den nedbrutna databas kopian återskapar logg uppspelnings kön</span><span class="sxs-lookup"><span data-stu-id="91da6-148">Lagged database copies in Exchange Online have an availability threshold, typically around 90%, due to periods where the disk containing a lagged copy is lost due to disk failure, the lagged copy becoming a highly-available copy (due to automatic play down), as well as the periods where the lagged database copy is re-building the log replay queue.</span></span> 

## <a name="transport-resilience"></a><span data-ttu-id="91da6-149">Transport återhämtning</span><span class="sxs-lookup"><span data-stu-id="91da6-149">Transport Resilience</span></span> 
<span data-ttu-id="91da6-150">Exchange Online inkluderar två primära funktioner för överförings återhämtning: skugg redundans och säkerhets nät.</span><span class="sxs-lookup"><span data-stu-id="91da6-150">Exchange Online includes two primary transport resilience features: Shadow Redundancy and Safety Net.</span></span> <span data-ttu-id="91da6-151">Skugg redundans ger en redundant kopia av ett meddelande när det är i transit.</span><span class="sxs-lookup"><span data-stu-id="91da6-151">Shadow Redundancy keeps a redundant copy of a message while it is in transit.</span></span> <span data-ttu-id="91da6-152">Säkerhets nät bevarar ett redundant meddelande när meddelandet har levererats.</span><span class="sxs-lookup"><span data-stu-id="91da6-152">Safety Net keeps a redundant copy of a message after the message is successfully delivered.</span></span> 

<span data-ttu-id="91da6-153">Om du har skugg redundans gör varje Exchange Online Transport Server en kopia av varje meddelande som tas emot innan det bekräftar att meddelandet skickades till den sändande servern.</span><span class="sxs-lookup"><span data-stu-id="91da6-153">With Shadow Redundancy, each Exchange Online transport server makes a copy of each message it receives before it acknowledges successfully receiving the message to the sending server.</span></span> <span data-ttu-id="91da6-154">Då blir alla meddelanden i transport förloppet redundanta under överföring.</span><span class="sxs-lookup"><span data-stu-id="91da6-154">This makes all messages in the transport pipeline redundant while in transit.</span></span> <span data-ttu-id="91da6-155">Om Exchange Online bestämmer att det ursprungliga meddelandet förlorades under överföringen omlevereras en överflödig kopia av meddelandet.</span><span class="sxs-lookup"><span data-stu-id="91da6-155">If Exchange Online determines the original message was lost in transit, a redundant copy of the message is redelivered.</span></span> 

<span data-ttu-id="91da6-156">Säkerhets nät är en transport kö som är kopplad till transport tjänsten på en post låda.</span><span class="sxs-lookup"><span data-stu-id="91da6-156">Safety Net is a transport queue that is associated with the Transport service on a Mailbox server.</span></span> <span data-ttu-id="91da6-157">I den här kön lagras kopior av meddelanden som bearbetades av servern.</span><span class="sxs-lookup"><span data-stu-id="91da6-157">This queue stores copies of messages that were successfully processed by the server.</span></span> <span data-ttu-id="91da6-158">När en post låda-databas eller server fel måste aktivera en gammal kopia av post lådans databas, skickas meddelanden i säkerhets kön automatiskt till den nya aktiva kopian av post lådan.</span><span class="sxs-lookup"><span data-stu-id="91da6-158">When a mailbox database or server failure requires activating an out-of-date copy of the mailbox database, messages in the Safety Net queue are automatically resubmitted to the new active copy of the mailbox database.</span></span> <span data-ttu-id="91da6-159">Säkerhets nätet är också överflödigt och eliminerar transport som en enda fel källa.</span><span class="sxs-lookup"><span data-stu-id="91da6-159">Safety Net is also redundant, thereby eliminating transport as a single point of failure.</span></span> <span data-ttu-id="91da6-160">Den använder begreppet primära säkerhets nät och en skugg säkerhet net om det primära säkerhets nätet inte är tillgängligt i mer än 12 timmar blir omsändnings begär Anden om omsändning av en skugg kopia och meddelanden skickas vidare igen från säkerheten på säkerhets nätet.</span><span class="sxs-lookup"><span data-stu-id="91da6-160">It uses the concept of a Primary Safety Net and a Shadow Safety Net wherein if the Primary Safety Net is unavailable for more than 12 hours, resubmit requests become shadow resubmit requests, and messages are re-delivered from the Shadow Safety Net.</span></span>

<span data-ttu-id="91da6-161">Meddelande om att meddelanden tas ut från säkerhets nät automatiskt initieras av den Active Manager-komponenten i Microsoft Exchange-replikeringstjänsten som hanterar DAGs-och post lådans databas kopior.</span><span class="sxs-lookup"><span data-stu-id="91da6-161">Message resubmissions from Safety Net are automatically initiated by the Active Manager component of the Microsoft Exchange Replication service that manages DAGs and mailbox database copies.</span></span> <span data-ttu-id="91da6-162">Inga manuella åtgärder krävs för att skicka om meddelanden från säkerhets nätet.</span><span class="sxs-lookup"><span data-stu-id="91da6-162">No manual actions are required to resubmit messages from Safety Net.</span></span> 

## <a name="single-bit-correction"></a><span data-ttu-id="91da6-163">Enkel bit korrigering</span><span class="sxs-lookup"><span data-stu-id="91da6-163">Single Bit Correction</span></span> 
<span data-ttu-id="91da6-164">ESE innehåller en mekanism för att upptäcka och lösa problem med enkel bit (aka Single bit-kast) som är resultatet av maskin varu fel (och som sådana representerar fysiska skador).</span><span class="sxs-lookup"><span data-stu-id="91da6-164">ESE includes a mechanism to detect and resolve single-bit CRC errors (aka single-bit flips) that are the result of hardware errors (and as such they represent physical corruption).</span></span> <span data-ttu-id="91da6-165">När de här felen inträffar rättas de automatiskt och loggar en händelse i händelse loggen.</span><span class="sxs-lookup"><span data-stu-id="91da6-165">When these errors occur, ESE automatically corrects them and logs an event in the event log.</span></span> 

## <a name="online-database-scanning"></a><span data-ttu-id="91da6-166">Online-databas genomsökning</span><span class="sxs-lookup"><span data-stu-id="91da6-166">Online Database Scanning</span></span> 
<span data-ttu-id="91da6-167">Databas genomsökning online (kallas även *databas*kontroll bild) är den process där en databas konsekvens kontroll används för att läsa varje sida och kontrol lera om sidan är skadad.</span><span class="sxs-lookup"><span data-stu-id="91da6-167">Online database scanning (also known as *database checksumming*) is the process where an ESE uses a database consistency checker to read each page and check for page corruption.</span></span> <span data-ttu-id="91da6-168">Det primära syftet är att upptäcka fysiska skador och förlorade tömningar som kanske inte identifieras av transaktions åtgärder.</span><span class="sxs-lookup"><span data-stu-id="91da6-168">The primary purpose is to detect physical corruption and lost flushes that may not be getting detected by transactional operations.</span></span> <span data-ttu-id="91da6-169">Databas genomsökning utför också en krasch åtgärd efter en post.</span><span class="sxs-lookup"><span data-stu-id="91da6-169">Database scanning also performs post-store crash operations.</span></span> <span data-ttu-id="91da6-170">Utrymmet kan läckas på grund av kraschar och online-databas genomsökningen hittar och återställer förlorade utrymmen.</span><span class="sxs-lookup"><span data-stu-id="91da6-170">Space can be leaked due to crashes, and online database scanning finds and recovers lost space.</span></span> <span data-ttu-id="91da6-171">Systemet är utformat med den förväntade att varje databas är fullständigt skannad en gång var sjunde dag.</span><span class="sxs-lookup"><span data-stu-id="91da6-171">The system is designed with the expectation that every database is fully scanned once every seven days.</span></span> 

## <a name="lost-flush-detection"></a><span data-ttu-id="91da6-172">Förlorad dubblettidentifiering</span><span class="sxs-lookup"><span data-stu-id="91da6-172">Lost Flush Detection</span></span> 
<span data-ttu-id="91da6-173">En förlorad tömning sker när en databas skrivnings åtgärd, som disk under systemet/operativ systemet returnerade som färdigt, faktiskt inte skrevs till disken eller skrevs in på fel plats.</span><span class="sxs-lookup"><span data-stu-id="91da6-173">A lost flush occurs when a database write operation that the disk subsystem/operating system returned as completed did not actually get written to disk, or was written in the wrong location.</span></span> <span data-ttu-id="91da6-174">Förlorade tömnings incidenter kan resultera i logisk databas skada, så för att förhindra förlorade tömningar från resulterade förlorade data innehåller ESE en förlorad funktion för dubblettidentifiering.</span><span class="sxs-lookup"><span data-stu-id="91da6-174">Lost flush incidents can result in database logical corruption, so to prevent lost flushes from resulting in lost data, ESE includes a lost flush detection mechanism.</span></span> <span data-ttu-id="91da6-175">Eftersom databas sidor skrivs till passiva kopior utförs en kontroll för förlorade tömningar på den aktiva kopian.</span><span class="sxs-lookup"><span data-stu-id="91da6-175">As database pages are written to passive copies, a check is performed for lost flushes on the active copy.</span></span> <span data-ttu-id="91da6-176">Om en förlorad tömning identifieras kan ESE reparera processen med en sid korrigerings process.</span><span class="sxs-lookup"><span data-stu-id="91da6-176">If a lost flush is detected, ESE can repair the process using a page patching process.</span></span> 

## <a name="single-page-restore"></a><span data-ttu-id="91da6-177">Återställning med en enda sida</span><span class="sxs-lookup"><span data-stu-id="91da6-177">Single Page Restore</span></span> 
<span data-ttu-id="91da6-178">Återställning av en enda sida, aka *sid korrigering*, är en automatisk process där skadade databas sidor ersätts med friska kopior från en felfri replik.</span><span class="sxs-lookup"><span data-stu-id="91da6-178">Single page restore, aka *page patching*, is an automatic process where corrupt database pages are replaced by healthy copies from a healthy replica.</span></span> <span data-ttu-id="91da6-179">Reparations processen för en skadad sida beror på om databas kopian är aktiv eller passiv.</span><span class="sxs-lookup"><span data-stu-id="91da6-179">The repair process for a corrupt page depends on whether the database copy is active or passive.</span></span> <span data-ttu-id="91da6-180">När en aktiv databas kopia stöter på en skadad sida kan den kopiera en sida från en av dess repliker, förutsatt att sidan den kopierar är helt uppdaterad.</span><span class="sxs-lookup"><span data-stu-id="91da6-180">When an active database copy encounters a corrupted page, it can copy a page from one of its replicas, provided the page it copies is completely up-to-date.</span></span> <span data-ttu-id="91da6-181">Det gör du genom att skicka en begäran om sidan till logg strömmen, som är grunden för databas replikering för post lådor.</span><span class="sxs-lookup"><span data-stu-id="91da6-181">This is accomplished by putting a request for the page into the log stream, which is the basis of mailbox database replication.</span></span> <span data-ttu-id="91da6-182">Så fort en replik påträffar sidans begäran svarar den genom att skicka en kopia av sidan till den begärda databas kopian.</span><span class="sxs-lookup"><span data-stu-id="91da6-182">As soon as a replica encounters the page request it responds by sending a copy of the page to the requesting database copy.</span></span> <span data-ttu-id="91da6-183">En enkel sid återställning ger också asynkron kommunikation för Active för att begära en sida från repliker, även om replikerna för närvarande är offline.</span><span class="sxs-lookup"><span data-stu-id="91da6-183">Single page restore also provides an asynchronous communication mechanism for the active to request a page from replicas, even if the replicas are currently offline.</span></span> 

<span data-ttu-id="91da6-184">Om det är skadat i en passiv databas kopia, inklusive en nedskriven databas kopia, eftersom dessa kopior alltid ligger bakom sina aktiva kopior är det alltid säkert att kopiera en sida från den aktiva kopian till en passiv kopia.</span><span class="sxs-lookup"><span data-stu-id="91da6-184">In case of corruption in a passive database copy, including a lagged database copy, because these copies are always behind their active copy, it is always safe to copy any page from the active copy to a passive copy.</span></span> <span data-ttu-id="91da6-185">En passiv databas kopia är med hög tillgänglighet, så under processen för sid korrigering avbryts loggningen, men kopieringen fortsätter.</span><span class="sxs-lookup"><span data-stu-id="91da6-185">A passive database copy is by nature highly available, so during the page patching process, log replaying is suspended, but log copying continues.</span></span> <span data-ttu-id="91da6-186">Den passiva databas kopian hämtar en kopia av den skadade sidan från den aktiva kopian, men väntar tills logg filen som uppfyller det maximala kravet för loggnings skapande är kopierad och inspekterad och sedan patchar den skadade sidan.</span><span class="sxs-lookup"><span data-stu-id="91da6-186">The passive database copy retrieves a copy of the corrupted page from the active copy, waits until the log file which meets the maximum required log generation requirement is copied and inspected, and then patches the corrupt page.</span></span> <span data-ttu-id="91da6-187">När sidan har uppdaterats fortsätter loggningen.</span><span class="sxs-lookup"><span data-stu-id="91da6-187">Once the page has been patched, log replay resumes.</span></span> <span data-ttu-id="91da6-188">Processen är densamma för den avvecklade databas kopian, förutom att den nedarbetade databasen först spelar upp alla loggfiler som behövs för att du ska kunna göra ett korrigerings känsligt tillstånd.</span><span class="sxs-lookup"><span data-stu-id="91da6-188">The process is the same for the lagged database copy, except that the lagged database first replays all log files that are necessary to achieve a patchable state.</span></span> 

## <a name="mailbox-replication-service"></a><span data-ttu-id="91da6-189">Tjänsten Mailbox Replication</span><span class="sxs-lookup"><span data-stu-id="91da6-189">Mailbox Replication Service</span></span> 
<span data-ttu-id="91da6-190">Att flytta post lådor är en viktig del av att hantera en storskalig e-posttjänst.</span><span class="sxs-lookup"><span data-stu-id="91da6-190">Moving mailboxes is a key part of managing a large-scale email service.</span></span> <span data-ttu-id="91da6-191">Det finns alltid uppdaterade teknologier och hård varu-och versions uppgraderingar att hantera, så det är ett robust, begränsat system som gör att våra tekniker kan utföra detta arbete samtidigt som post lådan flyttas transparent till användarna (genom att se till att de är online hela processen) är en nyckel och se till att processen blir större och större.</span><span class="sxs-lookup"><span data-stu-id="91da6-191">There are always updated technologies and hardware and version upgrades to deal with, so having a robust, throttled system that enables our engineers to accomplish this work while keeping the mailbox moves transparent to users (by making sure they stay online throughout the process) is key and making sure that the process scales up gracefully as mailboxes get larger and larger.</span></span> 

<span data-ttu-id="91da6-192">Replikeringstjänsten för Exchange-postlådan (MRS) är ansvarig för att flytta post lådor mellan databaser.</span><span class="sxs-lookup"><span data-stu-id="91da6-192">The Exchange Mailbox Replication Service (MRS) is responsible for moving mailboxes between databases.</span></span> <span data-ttu-id="91da6-193">Under flytten MRS utför en konsekvens kontroll av alla objekt i post lådan.</span><span class="sxs-lookup"><span data-stu-id="91da6-193">During the move, MRS performs a consistency check on all items within the mailbox.</span></span> <span data-ttu-id="91da6-194">Om det finns ett konsekvens problem kan MRS antingen rätta till problemet eller hoppa över de skadade objekten och därmed ta bort skadan från post lådan.</span><span class="sxs-lookup"><span data-stu-id="91da6-194">If a consistency issue is found, MRS will either correct the problem, or skip the corrupted items, thereby removing the corruption from the mailbox.</span></span> 

<span data-ttu-id="91da6-195">Eftersom MRS är en komponent i Exchange Online kan vi göra ändringar i dess kod för att åtgärda nya skador som upptäcks i framtiden.</span><span class="sxs-lookup"><span data-stu-id="91da6-195">Because MRS is a component of Exchange Online, we can make changes in its code to address new forms of corruption that are detected in the future.</span></span> <span data-ttu-id="91da6-196">Om vi till exempel upptäcker ett problem med konsekvens som MRS inte kan lösa kan vi analysera skadan, ändra MRS-koden och korrigera inkonsekvensen (om vi förstår hur du gör).</span><span class="sxs-lookup"><span data-stu-id="91da6-196">For example, if we detect a consistency issue that MRS is not able to fix, we can analyze the corruption, change the MRS code and correct the inconsistency (if we understand how to).</span></span> 

## <a name="log-file-checks"></a><span data-ttu-id="91da6-197">Logg fils kontroller</span><span class="sxs-lookup"><span data-stu-id="91da6-197">Log File Checks</span></span> 
<span data-ttu-id="91da6-198">Alla transaktionsloggfiler som genereras av en Exchange-databas genomgår flera olika former av konsekvens kontroller.</span><span class="sxs-lookup"><span data-stu-id="91da6-198">All transaction log files generated by an Exchange database undergo several forms of consistency checks.</span></span> <span data-ttu-id="91da6-199">När en loggfil skapas är det första som färdigt är ett bit mönster som skrivs och sedan utförs en serie loggnings skrivningar.</span><span class="sxs-lookup"><span data-stu-id="91da6-199">When a log file is created, the first thing done is a bit pattern is written and then a series of log writes is performed.</span></span> <span data-ttu-id="91da6-200">Det gör det möjligt för Exchange Online att utföra en serie kontroller (förlorad tömning, CRC och andra kontroller) för att verifiera varje loggfil medan den är skriven och igen.</span><span class="sxs-lookup"><span data-stu-id="91da6-200">This enables Exchange Online to execute a series of checks (lost flush, CRC and other checks) to validate each log file as it is written, and again as it is replicated.</span></span> 

## <a name="deployment-on-resilient-file-system"></a><span data-ttu-id="91da6-201">Distribution av elastiskt fil system</span><span class="sxs-lookup"><span data-stu-id="91da6-201">Deployment on Resilient File System</span></span> 
<span data-ttu-id="91da6-202">För att förhindra att skador uppstår på fil Systems nivå distribueras Exchange Online på ReFS-partitioner (elastiska fil system) för bättre återställnings kapacitet.</span><span class="sxs-lookup"><span data-stu-id="91da6-202">To help prevent corruption from occurring at the file system level, Exchange Online is being deployed on Resilient File System (ReFS) partitions to provide improved recovery capabilities.</span></span> <span data-ttu-id="91da6-203">ReFS är ett fil system i Windows Server 2012 och senare som är utformat för att vara mer elastiskt mot datafel för att maximera data tillgänglighet och integritet.</span><span class="sxs-lookup"><span data-stu-id="91da6-203">ReFS is a file system in Windows Server 2012 and later that is designed to be more resilient against data corruption thereby maximizing data availability and integrity.</span></span> <span data-ttu-id="91da6-204">Specifikt ger ReFS förbättringar av hur metadata uppdateras och ger bättre skydd för data och minskar risken för skadade data.</span><span class="sxs-lookup"><span data-stu-id="91da6-204">Specifically, ReFS brings improvements in the way that metadata is updated which offers better protection for data and reduces data corruption cases.</span></span> <span data-ttu-id="91da6-205">Dessutom används kontroll summor för att verifiera att fildata och metadata garanterar att skadade data är enkla att hitta och reparera.</span><span class="sxs-lookup"><span data-stu-id="91da6-205">It also uses checksums to verify the integrity of file data and metadata ensuring that data corruption is easily found and repaired.</span></span> 

<span data-ttu-id="91da6-206">Exchange Online drar nytta av flera ReFS-fördelar:</span><span class="sxs-lookup"><span data-stu-id="91da6-206">Exchange Online takes advantage of several ReFS benefits:</span></span> 
- <span data-ttu-id="91da6-207">Mer återhämtning i data integritet innebär färre incidenter för datafel.</span><span class="sxs-lookup"><span data-stu-id="91da6-207">More resiliency in data integrity means fewer data corruption incidents.</span></span> <span data-ttu-id="91da6-208">Om du minskar antalet skade tillbud innebär det färre onödiga återfröer.</span><span class="sxs-lookup"><span data-stu-id="91da6-208">Reducing the number of corruption incidents means fewer unnecessary database reseeds.</span></span> 
- <span data-ttu-id="91da6-209">Kontroll summa som körs på metadata som möjliggör identifiering av skade fall och mer deterministically, vilket gör att vi kan åtgärda kundens datafel innan grått fungerar på data volymer.</span><span class="sxs-lookup"><span data-stu-id="91da6-209">Checksum running on metadata enabling detections of corruption cases sooner and more deterministically, allowing us to fix customer data corruption before grey failures occur on data volumes.</span></span>
- <span data-ttu-id="91da6-210">Utformad för att fungera bra med extremt stora data uppsättningar – petabytes och större – utan prestanda påverkan</span><span class="sxs-lookup"><span data-stu-id="91da6-210">Designed to work well with extremely large data sets—petabytes and larger—without performance impact</span></span>
- <span data-ttu-id="91da6-211">Stöd för andra funktioner som används i Exchange Online, till exempel BitLocker-kryptering.</span><span class="sxs-lookup"><span data-stu-id="91da6-211">Support for other features used by Exchange Online, such as BitLocker encryption.</span></span> 

<span data-ttu-id="91da6-212">Exchange Online har också nytta av andra ReFS-funktioner:</span><span class="sxs-lookup"><span data-stu-id="91da6-212">Exchange Online also benefits from other ReFS features:</span></span> 
- <span data-ttu-id="91da6-213">**Integritet (integritets strömmar)** – ReFS lagrar data på ett sätt som skyddar det från flera vanliga fel som kan orsaka data förlust.</span><span class="sxs-lookup"><span data-stu-id="91da6-213">**Integrity (Integrity Streams)** - ReFS stores data in a way that protects it from many of the common errors that can normally cause data loss.</span></span> <span data-ttu-id="91da6-214">I Microsoft 365 search används integritets strömmar för att hjälpa till med tidig identifiering av skadade diskar och kontroll summor för fil innehåll.</span><span class="sxs-lookup"><span data-stu-id="91da6-214">Microsoft 365 Search uses Integrity Streams to help with early disk corruption detection and checksums of file content.</span></span> <span data-ttu-id="91da6-215">Funktionen minskar också skade händelser som orsakas av "ofullständiga skrivningar" (när en Skriv åtgärd inte slutförs på grund av strömavbrott etc.).</span><span class="sxs-lookup"><span data-stu-id="91da6-215">The feature also reduces corruption incidents caused by “Torn Writes” (when a write operation does not complete due to power outages, etc.).</span></span> 
- <span data-ttu-id="91da6-216">**Tillgänglighet (restvärde)** -ReFS prioriterar tillgängligheten av data.</span><span class="sxs-lookup"><span data-stu-id="91da6-216">**Availability (Salvage)** - ReFS prioritizes the availability of data.</span></span> <span data-ttu-id="91da6-217">Historiskt, fil system är ofta mottagligt för datafel som skulle kräva att systemet kommer att tas offline för reparation.</span><span class="sxs-lookup"><span data-stu-id="91da6-217">Historically, file systems were often susceptible to data corruption that would require the system to be taken offline for repair.</span></span> <span data-ttu-id="91da6-218">Trots att det är skadat implementerar ReFS i sällsynta fall en funktion som tar bort skadade data från namn området på en Live Volume och ser till att bra data inte påverkas negativt av icke-reparerade skadade data.</span><span class="sxs-lookup"><span data-stu-id="91da6-218">Although rare, if corruption does occur, ReFS implements salvage, a feature that removes the corrupt data from the namespace on a live volume and ensures that good data is not adversely affected by non-repairable corrupt data.</span></span> <span data-ttu-id="91da6-219">Om du använder funktionen restvärde och isolerade datafel till Exchange Online-databas volymer innebär det att vi kan behålla icke-berörda databaser på en skadad volym mellan tiden för skada och reparation.</span><span class="sxs-lookup"><span data-stu-id="91da6-219">Applying the Salvage feature and isolating data corruption to Exchange Online database volumes means that we can keep non-affected databases on a corrupted volume healthy between the time of corruption and repair action.</span></span> <span data-ttu-id="91da6-220">Detta gör att databasens tillgänglighet blir mer lättillgänglig.</span><span class="sxs-lookup"><span data-stu-id="91da6-220">This increases the availability of databases that would normally be affected by such disk corruption issues.</span></span> 