---
title: Undersöka komprometterade konton med hjälp av Avancerad granskning
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
audience: Admin
ms.topic: article
ms.service: O365-seccomp
localization_priority: Priority
ms.collection:
- M365-security-compliance
search.appverid:
- MOE150
- MET150
ms.assetid: ''
description: Använd granskningsåtgärden MailItemsAccessed för postlådan till att utföra tekniska undersökningar av komprometterade användarkonton.
ms.openlocfilehash: e9dda101b330f6632e66c226156df3497ac38453
ms.sourcegitcommit: 27b2b2e5c41934b918cac2c171556c45e36661bf
ms.translationtype: HT
ms.contentlocale: sv-SE
ms.lasthandoff: 03/19/2021
ms.locfileid: "52161850"
---
# <a name="use-advanced-audit-to-investigate-compromised-accounts"></a><span data-ttu-id="6a22b-103">Undersöka komprometterade konton med hjälp av Avancerad granskning</span><span class="sxs-lookup"><span data-stu-id="6a22b-103">Use Advanced Audit to investigate compromised accounts</span></span>

<span data-ttu-id="6a22b-104">Ett komprometterat användarkonto (kallas även *-kontoövertagande*) är en typ av attack när angriparen får åtkomst till ett användarkonto som användare.</span><span class="sxs-lookup"><span data-stu-id="6a22b-104">A compromised user account (also called an *account takeover*) is a type of attack when an attacker gains access to a user account and operates as the user.</span></span> <span data-ttu-id="6a22b-105">Den här typen av attacker kan ibland orsaka mer skada än vad angriparen har tänkt sig.</span><span class="sxs-lookup"><span data-stu-id="6a22b-105">These types of attacks sometimes cause more damage than the attacker may have intended.</span></span> <span data-ttu-id="6a22b-106">När du undersöker komprometterade e-postkonton måste du förutsätta att mer e-postdata har komprometterats än vad som visas vid spårningen av angriparens faktiska närvaro.</span><span class="sxs-lookup"><span data-stu-id="6a22b-106">When investigating compromised email accounts, you have to assume that more mail data was compromised than may be indicated by tracing the attacker's actual presence.</span></span> <span data-ttu-id="6a22b-107">Beroende på typen av data i e-postmeddelandena måste du förutsätta att känslig information har komprometterats eller kan omfattas av tillsynsböter, såvida du inte kan bevisa att känslig information inte har exponerats.</span><span class="sxs-lookup"><span data-stu-id="6a22b-107">Depending on the type of data in email messages, you have to assume that sensitive information was compromised or face regulatory fines unless you can prove that sensitive information wasn't exposed.</span></span> <span data-ttu-id="6a22b-108">Exempelvis får HIPAA-reglerade organisationer avsevärda böter om det finns bevis på att information om patienthälsa har exponerats.</span><span class="sxs-lookup"><span data-stu-id="6a22b-108">For example, HIPAA-regulated organizations face significant fines if there is evidence that patient health information (PHI) was exposed.</span></span> <span data-ttu-id="6a22b-109">I dessa fall är angriparna sannolikt inte intresserade av patienhälsoinformationen, men organisationen måste rapportera dataöverträdelserna såvida de inte kan bevisa något annat.</span><span class="sxs-lookup"><span data-stu-id="6a22b-109">In these cases, attackers are unlikely to be interested in PHI, but organizations still must report data breaches unless they can prove otherwise.</span></span>

<span data-ttu-id="6a22b-110">För att hjälpa dig att undersöka komprometterade e-postkonton granskar vi nu åtkomsten till e-postdata per e-postprotokoll och klienter med åtgärden *MailItemsAccessed* för postlådegranskning.</span><span class="sxs-lookup"><span data-stu-id="6a22b-110">To help you with investigating compromise email accounts, we're now auditing accesses of mail data by mail protocols and clients with the *MailItemsAccessed* mailbox auditing action.</span></span> <span data-ttu-id="6a22b-111">Den här nya granskningsåtgärden gör det enklare att förstå e-postdataintrång och hjälper dig att se omfattningen av de specifika e-postobjekt som kan ha komprometterats.</span><span class="sxs-lookup"><span data-stu-id="6a22b-111">This new audited action will help investigators better understand email data breaches and help you identify the scope of compromises to specific mail items that may been compromised.</span></span> <span data-ttu-id="6a22b-112">Syftet med att använda den här nya granskningsåtgärden är att få ett tekniskt skydd som garanterar att viss e-postdata inte har komprometterats.</span><span class="sxs-lookup"><span data-stu-id="6a22b-112">The goal of using this new auditing action is forensics defensibility to help assert that a specific piece of mail data was not compromised.</span></span> <span data-ttu-id="6a22b-113">Om en angripare får åtkomst till ett visst e-postmeddelande granskas händelsen i Exchange Online, även om det inte finns någon indikation på att e-postobjektet faktiskt har lästs.</span><span class="sxs-lookup"><span data-stu-id="6a22b-113">If an attacker gained access to a specific piece of mail, Exchange Online audits the event even though there is no indication that the mail item was actually read.</span></span>

## <a name="the-mailitemsaccessed-mailbox-auditing-action"></a><span data-ttu-id="6a22b-114">Granskningsåtgärden MailItemsAccessed för postlådor</span><span class="sxs-lookup"><span data-stu-id="6a22b-114">The MailItemsAccessed mailbox auditing action</span></span>

<span data-ttu-id="6a22b-115">Den nya MailItemsAccessed-åtgärden ingår i den nya funktionen för [avancerad granskning](advanced-audit.md).</span><span class="sxs-lookup"><span data-stu-id="6a22b-115">The new MailItemsAccessed action is part of the new [Advanced Audit](advanced-audit.md) functionality.</span></span> <span data-ttu-id="6a22b-116">Det är en del av [Exchanges postlådegranskning](/office365/securitycompliance/enable-mailbox-auditing#mailbox-auditing-actions) och är aktiverad som standard för användare som har tilldelats en Office 365- eller Microsoft 365 E5-licens, eller för organisationer med en prenumeration på tillägget Microsoft 365 E5 Compliance.</span><span class="sxs-lookup"><span data-stu-id="6a22b-116">It's part of [Exchange mailbox auditing](/office365/securitycompliance/enable-mailbox-auditing#mailbox-auditing-actions) and is enabled by default for users that are assigned an Office 365 or Microsoft 365 E5 license or for organizations with a Microsoft 365 E5 Compliance add-on subscription.</span></span>

<span data-ttu-id="6a22b-117">Granskningsåtgärden MailItemsAccessed för postlådor omfattar alla e-postprotokoll: POP, IMAP, MAPI, EWS, Exchange ActiveSync och REST.</span><span class="sxs-lookup"><span data-stu-id="6a22b-117">The MailItemsAccessed mailbox auditing action covers all mail protocols: POP, IMAP, MAPI, EWS, Exchange ActiveSync, and REST.</span></span> <span data-ttu-id="6a22b-118">Den omfattar även båda typerna av åtkomst till e-post: *synkronisering* och *bindning*.</span><span class="sxs-lookup"><span data-stu-id="6a22b-118">It also covers both types of accessing mail: *sync* and *bind*.</span></span>

### <a name="auditing-sync-access"></a><span data-ttu-id="6a22b-119">Granskning av synkroniseringsåtkomst</span><span class="sxs-lookup"><span data-stu-id="6a22b-119">Auditing sync access</span></span>

<span data-ttu-id="6a22b-120">Synkroniseringsåtgärder registreras bara när en postlåda används i en skrivbordsversion av Outlook-klienten för Windows eller Mac.</span><span class="sxs-lookup"><span data-stu-id="6a22b-120">Sync operations are only recorded when a mailbox is accessed by a desktop version of the Outlook client for Windows or Mac.</span></span> <span data-ttu-id="6a22b-121">Under synkroniseringen laddar dessa klienter vanligtvis ned en stor uppsättning e-postobjekt från molnet till en lokal dator.</span><span class="sxs-lookup"><span data-stu-id="6a22b-121">During the sync operation, these clients typically download a large set of mail items from the cloud to a local computer.</span></span> <span data-ttu-id="6a22b-122">Granskningsvolymen för synkroniseringsåtgärder är enorm.</span><span class="sxs-lookup"><span data-stu-id="6a22b-122">The audit volume for sync operations is huge.</span></span> <span data-ttu-id="6a22b-123">I stället för att generera en granskningspost för varje e-postobjekt som synkroniseras, genererar vi bara en granskningshändelse för e-postmappen med de objekt som har synkroniserats.</span><span class="sxs-lookup"><span data-stu-id="6a22b-123">So, instead of generating an audit record for each mail item that's synched, we just generate an audit event for the mail folder containing items that were synched.</span></span> <span data-ttu-id="6a22b-124">Det görs ett antagande att *alla* e-postobjekt i den synkroniserade mappen har komprometterats.</span><span class="sxs-lookup"><span data-stu-id="6a22b-124">This makes the assumption that *all* mail items in the synched folder have been compromised.</span></span> <span data-ttu-id="6a22b-125">Åtkomsttypen registreras i fältet OperationProperties i granskningsposten.</span><span class="sxs-lookup"><span data-stu-id="6a22b-125">The access type is recorded in the OperationProperties field of the audit record.</span></span> 

<span data-ttu-id="6a22b-126">Se steg 2 i avsnittet [Använda MailItemsAccessed-granskningsposter för tekniska undersökningar](#use-mailitemsaccessed-audit-records-for-forensic-investigations) för ett exempel på hur du visar typen av synkroniseringsåtkomst i en granskningspost.</span><span class="sxs-lookup"><span data-stu-id="6a22b-126">See step 2 in the [Use MailItemsAccessed audit records for forensic investigations](#use-mailitemsaccessed-audit-records-for-forensic-investigations) section for an example of displaying the sync access type in an audit record.</span></span>

### <a name="auditing-bind-access"></a><span data-ttu-id="6a22b-127">Granskning av bindningsåtkomst</span><span class="sxs-lookup"><span data-stu-id="6a22b-127">Auditing bind access</span></span>

<span data-ttu-id="6a22b-128">En bindningsåtgärd är en enskild åtkomst till ett e-postmeddelande.</span><span class="sxs-lookup"><span data-stu-id="6a22b-128">A bind operation is an individual access to an email message.</span></span> <span data-ttu-id="6a22b-129">Vid bindningsåtkomst registreras InternetMessageId för enskilda meddelanden i granskningsposten.</span><span class="sxs-lookup"><span data-stu-id="6a22b-129">For bind access, the InternetMessageId of individual messages will be recorded in the audit record.</span></span> <span data-ttu-id="6a22b-130">Granskningsåtgärden MailItemsAccessed registrerar bindningsåtgärderna som sedan sammanställs till en enda granskningspost.</span><span class="sxs-lookup"><span data-stu-id="6a22b-130">The MailItemsAccessed audit action records bind operations and then aggregates into a single audit record.</span></span> <span data-ttu-id="6a22b-131">Alla bindningsåtgärder som utförs inom ett 2-minutersintervall sammanställs i en enskild granskningspost i fältet Mappar inom AuditData-egenskapen.</span><span class="sxs-lookup"><span data-stu-id="6a22b-131">All bind operations that occur within a 2-minute interval are aggregated in a single audit record in the Folders field within the AuditData property.</span></span> <span data-ttu-id="6a22b-132">Varje meddelande som öppnades identifieras med sitt InternetMessageId.</span><span class="sxs-lookup"><span data-stu-id="6a22b-132">Each message that was accessed is identified by its InternetMessageId.</span></span> <span data-ttu-id="6a22b-133">Antalet bindningsåtgärder som sammanställdes i posten visas i fältet OperationCount i AuditData-egenskapen.</span><span class="sxs-lookup"><span data-stu-id="6a22b-133">The number of bind operations that were aggregated in the record is displayed in the OperationCount field in the AuditData property.</span></span>

<span data-ttu-id="6a22b-134">Se steg 4 i avsnittet [Använda MailItemsAccessed-granskningsposter för tekniska undersökningar](#use-mailitemsaccessed-audit-records-for-forensic-investigations) för ett exempel på hur du visar typen av bindningsåtkomst i en granskningspost.</span><span class="sxs-lookup"><span data-stu-id="6a22b-134">See step 4 in the [Use MailItemsAccessed audit records for forensic investigations](#use-mailitemsaccessed-audit-records-for-forensic-investigations) section for an example of displaying the bind access type in an audit record.</span></span>

### <a name="throttling-of-mailitemsaccessed-audit-records"></a><span data-ttu-id="6a22b-135">Begränsning av MailItemsAccessed-granskningsposter</span><span class="sxs-lookup"><span data-stu-id="6a22b-135">Throttling of MailItemsAccessed audit records</span></span>

<span data-ttu-id="6a22b-136">Om fler än 1 000 MailItemsAccessed-granskningsposter genereras på mindre än 24 timmar, kommer Exchange Online att sluta generera granskningsposter för MailItemsAccessed-aktivitet.</span><span class="sxs-lookup"><span data-stu-id="6a22b-136">If more than 1,000 MailItemsAccessed audit records are generated in less than 24 hours, Exchange Online will stop generating auditing records for MailItemsAccessed activity.</span></span> <span data-ttu-id="6a22b-137">När en postlåda begränsas loggas inte MailItemsAccessed-aktiviteten i 24 timmar efter att postlådan har begränsats.</span><span class="sxs-lookup"><span data-stu-id="6a22b-137">When a mailbox is throttled, MailItemsAccessed activity will not be logged for 24 hours after the mailbox was throttled.</span></span> <span data-ttu-id="6a22b-138">Om det inträffar finns det en risk att postlådan har komprometterats under perioden.</span><span class="sxs-lookup"><span data-stu-id="6a22b-138">If this occurs, there's a potential that mailbox could have been compromised during this period.</span></span> <span data-ttu-id="6a22b-139">Registreringen av MailItemsAccessed-aktivitet återupptas efter en 24-timmars period.</span><span class="sxs-lookup"><span data-stu-id="6a22b-139">The recording of MailItemsAccessed activity will be resumed following a 24-hour period.</span></span>  

<span data-ttu-id="6a22b-140">Här är några saker att tänka på vid begränsning:</span><span class="sxs-lookup"><span data-stu-id="6a22b-140">Here's a few things to keep in mind about throttling:</span></span>

- <span data-ttu-id="6a22b-141">Mindre än 1 % av alla postlådor i Exchange Online är begränsade</span><span class="sxs-lookup"><span data-stu-id="6a22b-141">Less than 1% of all mailboxes in Exchange Online are throttled</span></span>

- <span data-ttu-id="6a22b-142">När en postlåda är begränsad är det bara granskningsposter för MailItemsAccessed-aktiviteten som inte granskas.</span><span class="sxs-lookup"><span data-stu-id="6a22b-142">When a mailbox is throttling, only audit records for MailItemsAccessed activity are not audited.</span></span> <span data-ttu-id="6a22b-143">Andra granskningsåtgärder för postlådan påverkas inte.</span><span class="sxs-lookup"><span data-stu-id="6a22b-143">Other mailbox auditing actions aren't affected.</span></span>

- <span data-ttu-id="6a22b-144">Postlådor begränsas endast för bindningsåtgärder.</span><span class="sxs-lookup"><span data-stu-id="6a22b-144">Mailboxes are throttled only for Bind operations.</span></span> <span data-ttu-id="6a22b-145">Granskningsposter för synkroniseringsåtgärder är inte begränsade.</span><span class="sxs-lookup"><span data-stu-id="6a22b-145">Audit records for sync operations are not throttled.</span></span>

- <span data-ttu-id="6a22b-146">Om en postlåda är begränsad kan du antagligen förutsätta att det fanns MailItemsAccessed-aktivitet som inte registrerades i granskningsloggarna.</span><span class="sxs-lookup"><span data-stu-id="6a22b-146">If a mailbox is throttled, you can probably assume there was MailItemsAccessed activity that wasn't recorded in the audit logs.</span></span>

<span data-ttu-id="6a22b-147">Se steg 1 i avsnittet [Använda MailItemsAccessed-granskningsposter för tekniska undersökningar](#use-mailitemsaccessed-audit-records-for-forensic-investigations) för ett exempel på hur du visar IsThrottled-egenskapen i en granskningspost.</span><span class="sxs-lookup"><span data-stu-id="6a22b-147">See step 1 in the [Use MailItemsAccessed audit records for forensic investigations](#use-mailitemsaccessed-audit-records-for-forensic-investigations) section for an example of displaying the IsThrottled property in an audit record.</span></span>

## <a name="use-mailitemsaccessed-audit-records-for-forensic-investigations"></a><span data-ttu-id="6a22b-148">Använda MailItemsAccessed-granskningsposter för tekniska undersökningar</span><span class="sxs-lookup"><span data-stu-id="6a22b-148">Use MailItemsAccessed audit records for forensic investigations</span></span>

<span data-ttu-id="6a22b-149">En granskning av postlådor genererar granskningsposter för åtkomst till e-postmeddelanden, så att du kan vara säker på att e-postmeddelandena inte har komprometterats.</span><span class="sxs-lookup"><span data-stu-id="6a22b-149">Mailbox auditing generates audit records for access to email messages so that you can be confident that email messages haven't been compromised.</span></span> <span data-ttu-id="6a22b-150">När vi inte är säkra på att åtkomst har funnits till viss data, antar vi därför att detta har skett genom att registrera all e-poståtkomstaktivitet.</span><span class="sxs-lookup"><span data-stu-id="6a22b-150">For this reason, in circumstances where we're not certain that some data has been accessed, we assume that it has by recording all mail access activity.</span></span>

<span data-ttu-id="6a22b-151">Användningen av MailItemsAccessed-granskningsposter i tekniskt syfte utförs vanligtvis när ett dataintrång har åtgärdats och angriparen har avlägsnats.</span><span class="sxs-lookup"><span data-stu-id="6a22b-151">Using MailItemsAccessed audit records for forensics purposes is typically performed after a data breach has been resolved and the attacker has been evicted.</span></span> <span data-ttu-id="6a22b-152">Påbörja undersökningen genom att identifiera den uppsättning postlådor som har komprometterats och fastställ tidsperioden då angriparen hade åtkomst till postlådor i organisationen.</span><span class="sxs-lookup"><span data-stu-id="6a22b-152">To begin your investigation, you should identify the set of mailboxes that they have been compromised and determine the time frame when attacker had access to mailboxes in your organization.</span></span> <span data-ttu-id="6a22b-153">Du kan sedan använda cmdletarna **Search-UnifiedAuditLog** eller **Search-MailboxAuditLog** i [Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell) för att söka i granskningsposter som motsvarar dataintrånget.</span><span class="sxs-lookup"><span data-stu-id="6a22b-153">Then, you can use the **Search-UnifiedAuditLog** or **Search-MailboxAuditLog** cmdlets in [Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell) to search audit records that correspond to the data breach.</span></span> 

<span data-ttu-id="6a22b-154">Du kan köra ett av följande kommandon för att söka efter MailItemsAccessed-granskningsposter:</span><span class="sxs-lookup"><span data-stu-id="6a22b-154">You can run one of the following commands to search for MailItemsAccessed audit records:</span></span>

<span data-ttu-id="6a22b-155">**Enhetlig granskningslogg**</span><span class="sxs-lookup"><span data-stu-id="6a22b-155">**Unified audit log**</span></span>

```powershell
Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000
```

<span data-ttu-id="6a22b-156">**Granskningslogg för postlåda**</span><span class="sxs-lookup"><span data-stu-id="6a22b-156">**Mailbox audit log**</span></span>

```powershell
Search-MailboxAuditLog -Identity <user> -StartDate 01/06/2020 -EndDate 01/20/2020 -Operations MailItemsAccessed -ResultSize 1000 -ShowDetails
```

> [!TIP]
> <span data-ttu-id="6a22b-157">En viktig skillnad mellan dessa två cmdletar är att du kan använda cmdleten **Search-UnifiedAuditLog** till att söka efter granskningsposter för aktivitet som har utförts av en eller flera användare.</span><span class="sxs-lookup"><span data-stu-id="6a22b-157">One primary difference between these two cmdlets in that you can use the **Search-UnifiedAuditLog** cmdlet to search for audit records for activity performed by one or more users.</span></span> <span data-ttu-id="6a22b-158">Det beror på att *UserIds* är en parameter med flera värden.</span><span class="sxs-lookup"><span data-stu-id="6a22b-158">That's because *UserIds* is a multi-value parameter.</span></span> <span data-ttu-id="6a22b-159">Cmdleten **Search-MailboxAuditLog** söker i granskningsloggen för postlådan efter en enskild användare.</span><span class="sxs-lookup"><span data-stu-id="6a22b-159">The **Search-MailboxAuditLog** cmdlet searches the mailbox audit log for a single user.</span></span>

<span data-ttu-id="6a22b-160">Här är stegen för att använda MailItemsAccessed-granskningsposter vid undersökning av ett komprometterat användarangrepp.</span><span class="sxs-lookup"><span data-stu-id="6a22b-160">Here are the steps for using MailItemsAccessed audit records to investigate a compromised user attack.</span></span> <span data-ttu-id="6a22b-161">Varje steg visar kommandosyntaxen för cmdletarna **Search-UnifiedAuditLog** eller **Search-MailboxAuditLog**.</span><span class="sxs-lookup"><span data-stu-id="6a22b-161">Each step shows the command syntax for the **Search-UnifiedAuditLog** or **Search-MailboxAuditLog** cmdlets.</span></span>

1. <span data-ttu-id="6a22b-162">Kontrollera om postlådan har begränsats.</span><span class="sxs-lookup"><span data-stu-id="6a22b-162">Check whether the mailbox has been throttled.</span></span> <span data-ttu-id="6a22b-163">I så fall kan det innebära att vissa granskningsposter för postlådan inte har loggats.</span><span class="sxs-lookup"><span data-stu-id="6a22b-163">If so, this would mean that some mailbox auditing records would not have been logged.</span></span> <span data-ttu-id="6a22b-164">Om någon granskningspost har ”IsThrottled” som ”Sant” kan du förutsätta att under en 24-timmarsperiod efter att posten genererades granskades inte någon åtkomst till postlådan och att alla e-postdata har komprometterats.</span><span class="sxs-lookup"><span data-stu-id="6a22b-164">In the case that any audit records have the "IsThrottled" is "True," you should assume that for a 24-hour period afterwards that record was generated, that any access to the mailbox was not audited and that all mail data has been compromised.</span></span>

   <span data-ttu-id="6a22b-165">Om du vill söka efter MailItemsAccessed-poster där postlådan var begränsad kör du följande kommando:</span><span class="sxs-lookup"><span data-stu-id="6a22b-165">To search for MailItemsAccessed records where the mailbox was throttled, run the following command:</span></span>

   <span data-ttu-id="6a22b-166">**Enhetlig granskningslogg**</span><span class="sxs-lookup"><span data-stu-id="6a22b-166">**Unified audit log**</span></span>
 
   ```powershell
   Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000 | Where {$_.AuditData -like '*"IsThrottled","Value":"True"*'} | FL
   ```

   <span data-ttu-id="6a22b-167">**Granskningslogg för postlåda**</span><span class="sxs-lookup"><span data-stu-id="6a22b-167">**Mailbox audit log**</span></span>

   ```powershell
   Search-MailboxAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -Identity <user> -Operations MailItemsAccessed -ResultSize 10000 -ShowDetails | Where {$_.OperationProperties -like "*IsThrottled:True*"} | FL
   ```

2. <span data-ttu-id="6a22b-168">Kontrollera om det finns synkroniseringsaktiviteter.</span><span class="sxs-lookup"><span data-stu-id="6a22b-168">Check for sync activities.</span></span> <span data-ttu-id="6a22b-169">Om en angripare använder en e-postklient för att hämta meddelanden i en postlåda, kan de koppla bort datorn från Internet och komma åt meddelandena lokalt utan att interagera med servern.</span><span class="sxs-lookup"><span data-stu-id="6a22b-169">If an attacker uses an email client to downloaded messages in a mailbox, they can disconnect the computer from the Internet and access the messages locally without interacting with the server.</span></span> <span data-ttu-id="6a22b-170">Det innebär att granskningen av postlådan inte kan granska de här aktiviteterna.</span><span class="sxs-lookup"><span data-stu-id="6a22b-170">This means that mailbox auditing would not be able to audit these activities.</span></span>

   <span data-ttu-id="6a22b-171">Om du vill söka efter MailItemsAccessed-poster där e-postobjekten användes av en synkroniseringsåtgärd, kör du följande kommando:</span><span class="sxs-lookup"><span data-stu-id="6a22b-171">To search for MailItemsAccessed records where the mail items were accessed by a sync operation, run the following command:</span></span>

   <span data-ttu-id="6a22b-172">**Enhetlig granskningslogg**</span><span class="sxs-lookup"><span data-stu-id="6a22b-172">**Unified audit log**</span></span>

   ```powershell
   Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 02/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000 | Where {$_.AuditData -like '*"MailAccessType","Value":"Sync"*'} | FL
   ```

   <span data-ttu-id="6a22b-173">**Granskningslogg för postlåda**</span><span class="sxs-lookup"><span data-stu-id="6a22b-173">**Mailbox audit log**</span></span>

   ```powershell
   Search-MailboxAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -Identity <user> -Operations MailItemsAccessed -ResultSize 10000 -ShowDetails | Where {$_.OperationProperties -like "*MailAccessType:Sync*"} | FL
   ```

3. <span data-ttu-id="6a22b-174">Kontrollera synkroniseringsaktiviteterna för att fastställa om någon av dem har inträffat i samma kontext som den som användes av angriparen.</span><span class="sxs-lookup"><span data-stu-id="6a22b-174">Check sync activities to determine in any of them have occurred in the same context as the one used by the attacker access the mailbox.</span></span> <span data-ttu-id="6a22b-175">Kontext identifieras och differentieras av IP-adressen till den klientdator som används för åtkomst till postlådan och e-postprotokollet.</span><span class="sxs-lookup"><span data-stu-id="6a22b-175">Context is identified and differentiated by the IP address of the client computer used to access the mailbox and the mail protocol.</span></span> <span data-ttu-id="6a22b-176">Mer information finns i avsnittet [Identifiera åtkomstkontexterna för olika granskningsposter](#identifying-the-access-contexts-of-different-audit-records).</span><span class="sxs-lookup"><span data-stu-id="6a22b-176">For more information, see the [Identifying the access contexts of different audit records](#identifying-the-access-contexts-of-different-audit-records) section.</span></span>

   <span data-ttu-id="6a22b-177">Använd egenskaperna nedan vid undersökningen.</span><span class="sxs-lookup"><span data-stu-id="6a22b-177">Use the properties listed below to investigate.</span></span> <span data-ttu-id="6a22b-178">Egenskaperna finns i egenskapen AuditData eller OperationProperties.</span><span class="sxs-lookup"><span data-stu-id="6a22b-178">These properties are located in the AuditData or OperationProperties property.</span></span> <span data-ttu-id="6a22b-179">Om någon av synkroniseringarna sker i samma kontext som angriparens aktivitet, förutsätter du att angriparen har synkroniserat alla e-postobjekt till klienten, vilket innebär att hela postlådan troligen har komprometterats.</span><span class="sxs-lookup"><span data-stu-id="6a22b-179">If any of the syncs occur in the same context as the attacker activity, assume the attacker has synced all mail items to their client, which means the entire mailbox has probably been compromised.</span></span>

   |<span data-ttu-id="6a22b-180">Egenskap</span><span class="sxs-lookup"><span data-stu-id="6a22b-180">Property</span></span>         | <span data-ttu-id="6a22b-181">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="6a22b-181">Description</span></span> |
   |:---------------- | :----------|
   |<span data-ttu-id="6a22b-182">ClientInfoString</span><span class="sxs-lookup"><span data-stu-id="6a22b-182">ClientInfoString</span></span> | <span data-ttu-id="6a22b-183">Beskriver protokoll och klient (inkl. version)</span><span class="sxs-lookup"><span data-stu-id="6a22b-183">Describes protocol, client (includes version)</span></span>|
   |<span data-ttu-id="6a22b-184">ClientIPAddress</span><span class="sxs-lookup"><span data-stu-id="6a22b-184">ClientIPAddress</span></span>  | <span data-ttu-id="6a22b-185">IP-adressen till klientdatorn.</span><span class="sxs-lookup"><span data-stu-id="6a22b-185">IP address of the client machine.</span></span>|
   |<span data-ttu-id="6a22b-186">SessionId</span><span class="sxs-lookup"><span data-stu-id="6a22b-186">SessionId</span></span>        | <span data-ttu-id="6a22b-187">Med ett sessions-ID kan du skilja på angriparens åtgärder och dagliga användaraktiviteter på samma konto (om ett konto har komprometterats)</span><span class="sxs-lookup"><span data-stu-id="6a22b-187">Session ID helps to differentiate attacker actions vs day-to-day user activities on the same account (in the case of a compromised account)</span></span>|
   |<span data-ttu-id="6a22b-188">UserId</span><span class="sxs-lookup"><span data-stu-id="6a22b-188">UserId</span></span>           | <span data-ttu-id="6a22b-189">UPN för användaren som läser meddelandet.</span><span class="sxs-lookup"><span data-stu-id="6a22b-189">UPN of the user reading the message.</span></span>|
   |||

4. <span data-ttu-id="6a22b-190">Kontrollera om det finns bindningsaktiviteter.</span><span class="sxs-lookup"><span data-stu-id="6a22b-190">Check for bind activities.</span></span> <span data-ttu-id="6a22b-191">När du har utfört steg 2 och 3 kan du vara säker på att all annan åtkomst till e-postmeddelanden för angriparen fångas i granskningsposterna för MailItemsAccessed som har egenskapen MailAccessType med värdet ”Bindning”.</span><span class="sxs-lookup"><span data-stu-id="6a22b-191">After performing steps 2 and step 3, you can be confident that all other access to email messages by the attacker will be captured in the MailItemsAccessed audit records that have a MailAccessType property with a value of "Bind".</span></span>

   <span data-ttu-id="6a22b-192">Om du vill söka efter MailItemsAccessed-poster där e-postobjekten användes av en bindningsåtgärd kör du följande kommando.</span><span class="sxs-lookup"><span data-stu-id="6a22b-192">To search for MailItemsAccessed records where the mail items were accessed by a Bind operation, run the following command.</span></span>

   <span data-ttu-id="6a22b-193">**Enhetlig granskningslogg**</span><span class="sxs-lookup"><span data-stu-id="6a22b-193">**Unified audit log**</span></span>

   ```powershell
   Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000 | Where {$_.AuditData -like '*"MailAccessType","Value":"Bind"*'} | FL
   ```
 
   <span data-ttu-id="6a22b-194">**Granskningslogg för postlåda**</span><span class="sxs-lookup"><span data-stu-id="6a22b-194">**Mailbox audit log**</span></span>
   
   ```powershell
   Search-MailboxAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -Identity <user> -Operations MailItemsAccessed -ResultSize 10000 -ShowDetails | Where {$_.OperationProperties -like "*MailAccessType:Bind*"} | FL
   ```

   <span data-ttu-id="6a22b-195">E-postmeddelanden som har öppnats identifieras med sitt ID för Internetmeddelanden. Du kan också kontrollera om några granskningsposter har samma kontext som de i angriparens aktivitet.</span><span class="sxs-lookup"><span data-stu-id="6a22b-195">Email messages that were accessed are identified by their internet message Id. You can also check to see if any audit records have the same context as the ones for other attacker activity.</span></span> <span data-ttu-id="6a22b-196">Mer information finns i avsnittet [Identifiera åtkomstkontexterna för olika granskningsposter](#identifying-the-access-contexts-of-different-audit-records).</span><span class="sxs-lookup"><span data-stu-id="6a22b-196">For more information, see the [Identifying the access contexts of different audit records](#identifying-the-access-contexts-of-different-audit-records) section.</span></span>
 
   <span data-ttu-id="6a22b-197">Du kan använda granskningsdata för bindningsåtgärder på två olika sätt:</span><span class="sxs-lookup"><span data-stu-id="6a22b-197">You can use the audit data for bind operations in two different ways:</span></span>

     - <span data-ttu-id="6a22b-198">Komma åt eller samla in alla e-postmeddelanden som angriparen fick åtkomst till med hjälp av InternetMessageId för att hitta dem och sedan kontrollera om något av dessa meddelanden innehåller känslig information.</span><span class="sxs-lookup"><span data-stu-id="6a22b-198">Access or collect all email messages the attacker accessed by using the InternetMessageId to find them and then checking to see if any of those messages contains sensitive information.</span></span>

     - <span data-ttu-id="6a22b-199">Använda InternetMessageId för att söka efter granskningsposter som är relaterade till en uppsättning potentiellt känsliga e-postmeddelanden.</span><span class="sxs-lookup"><span data-stu-id="6a22b-199">Use the InternetMessageId to search audit records related to a set of potentially sensitive email messages.</span></span> <span data-ttu-id="6a22b-200">Det här är användbart om du bara är orolig för ett litet antal meddelanden.</span><span class="sxs-lookup"><span data-stu-id="6a22b-200">This is useful if you're concerned only about a small number of messages.</span></span>

## <a name="filtering-of-duplicate-audit-records"></a><span data-ttu-id="6a22b-201">Filtrera dubbletter av granskningsposter</span><span class="sxs-lookup"><span data-stu-id="6a22b-201">Filtering of duplicate audit records</span></span>

<span data-ttu-id="6a22b-202">Dubbletter av granskningsposter för samma bindningsåtgärder som inträffar inom en timme filtreras bort.</span><span class="sxs-lookup"><span data-stu-id="6a22b-202">Duplicate audit records for the same bind operations that occur within an hour of each other are filtered out to remove auditing noise.</span></span> <span data-ttu-id="6a22b-203">Synkroniseringsåtgärder filtreras också bort med en timmes intervall.</span><span class="sxs-lookup"><span data-stu-id="6a22b-203">Sync operations are also filtered out at one-hour intervals.</span></span> <span data-ttu-id="6a22b-204">Undantag till dedupliceringsprocessen inträffar om någon av egenskaperna som beskrivs i tabellen nedan skiljer sig för samma InternetMessageId.</span><span class="sxs-lookup"><span data-stu-id="6a22b-204">The exception to this de-duplication process occurs if, for the same InternetMessageId, any of the properties described in the following table are different.</span></span> <span data-ttu-id="6a22b-205">Om en av de här egenskaperna skiljer sig åt vid en dubblettåtgärd genereras en ny granskningspost.</span><span class="sxs-lookup"><span data-stu-id="6a22b-205">If one of these properties is different in a duplicate operation, a new audit record is generated.</span></span> <span data-ttu-id="6a22b-206">Den här processen beskrivs mer ingående i nästa avsnitt.</span><span class="sxs-lookup"><span data-stu-id="6a22b-206">This process is described in more detail in the next section.</span></span>

| <span data-ttu-id="6a22b-207">Egenskap</span><span class="sxs-lookup"><span data-stu-id="6a22b-207">Property</span></span>| <span data-ttu-id="6a22b-208">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="6a22b-208">Description</span></span>|
|:--------|:---------|
|<span data-ttu-id="6a22b-209">ClientIPAddress</span><span class="sxs-lookup"><span data-stu-id="6a22b-209">ClientIPAddress</span></span> | <span data-ttu-id="6a22b-210">IP-adressen till klientdatorn.</span><span class="sxs-lookup"><span data-stu-id="6a22b-210">IP address of the client computer.</span></span>|
|<span data-ttu-id="6a22b-211">ClientInfoString</span><span class="sxs-lookup"><span data-stu-id="6a22b-211">ClientInfoString</span></span>| <span data-ttu-id="6a22b-212">Klientprotokollet som klienten använde för att komma åt postlådan.</span><span class="sxs-lookup"><span data-stu-id="6a22b-212">The client protocol, client used to access the mailbox.</span></span>| 
|<span data-ttu-id="6a22b-213">ParentFolder</span><span class="sxs-lookup"><span data-stu-id="6a22b-213">ParentFolder</span></span>    | <span data-ttu-id="6a22b-214">Den fullständiga mappsökvägen till det e-postobjekt som öppnades.</span><span class="sxs-lookup"><span data-stu-id="6a22b-214">The full folder path of the mail item that was accessed.</span></span> |
|<span data-ttu-id="6a22b-215">Logon_type</span><span class="sxs-lookup"><span data-stu-id="6a22b-215">Logon_type</span></span>      | <span data-ttu-id="6a22b-216">Inloggningstypen för användaren som utförde åtgärden.</span><span class="sxs-lookup"><span data-stu-id="6a22b-216">The logon type of the user who performed the action.</span></span> <span data-ttu-id="6a22b-217">Inloggningstyperna (och deras motsvarande uppräkningsvärde) är Ägare (0), Administratör (1) eller Ombud (2).</span><span class="sxs-lookup"><span data-stu-id="6a22b-217">The logon types (and their corresponding Enum value) are Owner (0), Admin (1), or Delegate (2).</span></span>|
|<span data-ttu-id="6a22b-218">MailAccessType</span><span class="sxs-lookup"><span data-stu-id="6a22b-218">MailAccessType</span></span>  | <span data-ttu-id="6a22b-219">Om åtkomsten är en bindnings- eller synkroniseringsåtgärd.</span><span class="sxs-lookup"><span data-stu-id="6a22b-219">Whether the access is a bind or a sync operation.</span></span>|
|<span data-ttu-id="6a22b-220">MailboxUPN</span><span class="sxs-lookup"><span data-stu-id="6a22b-220">MailboxUPN</span></span>      | <span data-ttu-id="6a22b-221">UPN för postlådan där det lästa meddelandet finns.</span><span class="sxs-lookup"><span data-stu-id="6a22b-221">The UPN of the mailbox where the message being read is located.</span></span>|
|<span data-ttu-id="6a22b-222">Användare</span><span class="sxs-lookup"><span data-stu-id="6a22b-222">User</span></span>            | <span data-ttu-id="6a22b-223">UPN för användaren som läser meddelandet.</span><span class="sxs-lookup"><span data-stu-id="6a22b-223">The UPN of the user reading the message.</span></span>|
|<span data-ttu-id="6a22b-224">SessionId</span><span class="sxs-lookup"><span data-stu-id="6a22b-224">SessionId</span></span>       | <span data-ttu-id="6a22b-225">Sessions-ID:t används till att skilja på angriparens åtgärder och dagliga användaraktiviteter i samma postlåda (om kontot har komprometterats). Mer information om sessioner finns i [Sammanhangsberoende angreppsaktivitet i sessioner i Exchange Online](https://techcommunity.microsoft.com/t5/exchange-team-blog/contextualizing-attacker-activity-within-sessions-in-exchange/ba-p/608801).</span><span class="sxs-lookup"><span data-stu-id="6a22b-225">The Session Id helps to differentiate attacker actions and day-to-day user activities in the same mailbox (in the case of account compromise) For more information about sessions, see [Contextualizing attacker activity within sessions in Exchange Online](https://techcommunity.microsoft.com/t5/exchange-team-blog/contextualizing-attacker-activity-within-sessions-in-exchange/ba-p/608801).</span></span>|
||||

## <a name="identifying-the-access-contexts-of-different-audit-records"></a><span data-ttu-id="6a22b-226">Identifiera åtkomstkontexterna för olika granskningsposter</span><span class="sxs-lookup"><span data-stu-id="6a22b-226">Identifying the access contexts of different audit records</span></span>

<span data-ttu-id="6a22b-227">Det är vanligt att en angripare får åtkomst till en postlåda samtidigt som postlådans ägare öppnar den.</span><span class="sxs-lookup"><span data-stu-id="6a22b-227">It's common that an attacker may access a mailbox at the same time the mailbox owner is accessing it.</span></span> <span data-ttu-id="6a22b-228">Det finns granskningspostegenskaper som definierar åtkomstkontexten som används för att skilja mellan åtkomst av angriparen och postlådans ägare.</span><span class="sxs-lookup"><span data-stu-id="6a22b-228">To differentiate between access by the attacker and the mailbox owner, there are audit record properties that define the context of the access.</span></span> <span data-ttu-id="6a22b-229">Som tidigare beskrivits genereras separata granskningsposter när värdena för de här egenskaperna är olika, även om aktiviteten inträffar inom aggregeringsintervallet.</span><span class="sxs-lookup"><span data-stu-id="6a22b-229">As previously explained, when the values for these properties are different, even when the activity occurs within the aggregation interval, separate audit records are generated.</span></span> <span data-ttu-id="6a22b-230">I följande exempel finns det tre olika granskningsposter.</span><span class="sxs-lookup"><span data-stu-id="6a22b-230">In the following example, there are three different audit records.</span></span> <span data-ttu-id="6a22b-231">Var och en differentieras med hjälp av sessions-ID och ClientIPAddress-egenskaper.</span><span class="sxs-lookup"><span data-stu-id="6a22b-231">Each one is differentiated by the Session Id and ClientIPAddress properties.</span></span> <span data-ttu-id="6a22b-232">De meddelanden som öppnas identifieras också.</span><span class="sxs-lookup"><span data-stu-id="6a22b-232">The messages that were accessed are also identified.</span></span>

|<span data-ttu-id="6a22b-233">Granskningspost 1</span><span class="sxs-lookup"><span data-stu-id="6a22b-233">Audit record 1</span></span>  |<span data-ttu-id="6a22b-234">Granskningspost 2</span><span class="sxs-lookup"><span data-stu-id="6a22b-234">Audit record 2</span></span>  |<span data-ttu-id="6a22b-235">Granskningspost 3</span><span class="sxs-lookup"><span data-stu-id="6a22b-235">Audit record 3</span></span>|
|---------|---------|---------|
|<span data-ttu-id="6a22b-236">ClientIPAddress **1**</span><span class="sxs-lookup"><span data-stu-id="6a22b-236">ClientIPAddress **1**</span></span><br/><span data-ttu-id="6a22b-237">SessionId **2**</span><span class="sxs-lookup"><span data-stu-id="6a22b-237">SessionId **2**</span></span>|<span data-ttu-id="6a22b-238">ClientIPAddress **2**</span><span class="sxs-lookup"><span data-stu-id="6a22b-238">ClientIPAddress **2**</span></span><br/><span data-ttu-id="6a22b-239">SessionId **2**</span><span class="sxs-lookup"><span data-stu-id="6a22b-239">SessionId **2**</span></span>|<span data-ttu-id="6a22b-240">ClientIPAddress **1**</span><span class="sxs-lookup"><span data-stu-id="6a22b-240">ClientIPAddress **1**</span></span><br/><span data-ttu-id="6a22b-241">SessionId **3**</span><span class="sxs-lookup"><span data-stu-id="6a22b-241">SessionId **3**</span></span>|
|<span data-ttu-id="6a22b-242">InternetMessageId **A**</span><span class="sxs-lookup"><span data-stu-id="6a22b-242">InternetMessageId **A**</span></span><br/><span data-ttu-id="6a22b-243">InternetMessageId **D**</span><span class="sxs-lookup"><span data-stu-id="6a22b-243">InternetMessageId **D**</span></span><br/><span data-ttu-id="6a22b-244">InternetMessageId **E**</span><span class="sxs-lookup"><span data-stu-id="6a22b-244">InternetMessageId **E**</span></span><br/><span data-ttu-id="6a22b-245">InternetMessageId **F**</span><span class="sxs-lookup"><span data-stu-id="6a22b-245">InternetMessageId **F**</span></span><br/>|<span data-ttu-id="6a22b-246">InternetMessageId **A**</span><span class="sxs-lookup"><span data-stu-id="6a22b-246">InternetMessageId **A**</span></span><br/><span data-ttu-id="6a22b-247">InternetMessageId **C**</span><span class="sxs-lookup"><span data-stu-id="6a22b-247">InternetMessageId **C**</span></span>|<span data-ttu-id="6a22b-248">InternetMessageId **B**</span><span class="sxs-lookup"><span data-stu-id="6a22b-248">InternetMessageId **B**</span></span> |
||||

<span data-ttu-id="6a22b-249">Om någon av egenskaperna i tabellen i föregående [avsnitt](#filtering-of-duplicate-audit-records) skiljer sig åt, genereras en separat granskningspost för att kunna spåra den nya kontexten.</span><span class="sxs-lookup"><span data-stu-id="6a22b-249">If any of the properties listed in the table in the [previous section](#filtering-of-duplicate-audit-records) are different, a separate audit record is generated to track the new context.</span></span> <span data-ttu-id="6a22b-250">Åtkomsterna sorteras i de separata granskningsposterna beroende på den kontext där aktiviteten ägde rum.</span><span class="sxs-lookup"><span data-stu-id="6a22b-250">Accesses will be sorted into the separate audit records depending on the context in which the activity took place.</span></span>

<span data-ttu-id="6a22b-251">I exempelvis de granskningsposter som visas i följande skärmbild, sorteras åtkomstaktiviteten i olika granskningsposter beroende på den kontext där åtkomsten ägde rum, även om vi öppnar e-posten från EWSEditor och OWA samtidigt.</span><span class="sxs-lookup"><span data-stu-id="6a22b-251">For example, in audit records shown in the following screenshot, though we are accessing mail from EWSEditor and OWA simultaneously, the access activity is collated in different audit records depending on the context in which the access took place.</span></span> <span data-ttu-id="6a22b-252">I det här fallet definieras kontexten med olika värden för ClientInfoString-egenskapen.</span><span class="sxs-lookup"><span data-stu-id="6a22b-252">In this case, the context is defined by different values for the ClientInfoString property.</span></span>

![Olika granskningsposter utifrån kontext](../media/MailItemsAccessed4.png)

<span data-ttu-id="6a22b-254">Här är syntaxen för kommandot som visades i föregående skärmbild:</span><span class="sxs-lookup"><span data-stu-id="6a22b-254">Here is the syntax for the command shown in the previous screenshot:</span></span>

```powershell
Search-MailboxAuditLog -Identity admin -ShowDetails -Operations MailItemsAccessed -ResultSize 2000 | Select LastAccessed,Operation,AuditOperationsCountInAggregatedRecord,ClientInfoString
```